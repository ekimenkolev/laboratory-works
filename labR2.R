rm(list=ls())
setwd("C:/R_labs/simulation modeling/")

library("rgl")
N <- 3
n <- 100
R = 1 # –†–∞–¥–∏—É—Å —à–∞—Ä–∞
center = sample(1:5, 3, replace=T) # –¶–µ–Ω—Ç—Ä —à–∞—Ä–∞ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π
center_hemisphere = c(0,0,0)
gamma = sample(1:5, 1)
sum_V = 0
# –í –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–µ —Ä–∞—Å–ø–æ–ª–æ–∂–µ–Ω —à–∞—Ä ùëÄ —Å —Ü–µ–Ω—Ç—Ä–æ–º –≤ —Ç–æ—á–∫–µ (ùë•0, ùë¶0, ùëß0) –∏ —Ä–∞–¥–∏—É—Å–æ–º ùëÖ.
# –¢—Ä–µ–±—É–µ—Ç—Å—è —Å –ø–æ–º–æ—â—å—é –º–µ—Ç–æ–¥–æ–≤ –ú–æ–Ω—Ç–µ-–ö–∞—Ä–ª–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –∏–Ω—Ç–µ–≥—Ä–∞–ª
# –ü—Ä–∏ —Ä–∞—Å—á–µ—Ç–∞—Ö –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –º–µ—Ç–æ–¥–æ–º —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏, –≤–∑—è–≤ –≤ –∫–∞—á–µ—Å—Ç–≤–µ
# –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–æ–µ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ
# –°—Ä–∞–≤–Ω–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã —Å–æ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–º –º–µ—Ç–æ–¥–æ–º –ú–æ–Ω—Ç–µ-–ö–∞—Ä–ª–æ
# (–≥–µ–Ω–µ—Ä–∞—Ü–∏—è —Ä–∞–≤–Ω–æ–º–µ—Ä–Ω–æ —Ä–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—ã—Ö —Ç–æ—á–µ–∫ –Ω–∞ –ø–æ–ª—É—Å—Ñ–µ—Ä–µ) 
# –≤ —Ç–µ—Ä–º–∏–Ω–∞—Ö –¥–∏—Å–ø–µ—Ä—Å–∏–∏ –æ—Ü–µ–Ω–æ–∫.

diskrim <- function(a, b, c) {
  d <- b * b - 4 * a * c
  # –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç —à–∞—Ä
  if (d > 0) {
    V=1
  }
  # –Ω–µ –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç —à–∞—Ä
  else{
    V=0
  }
  return(V)
}

#–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ –ú–æ–Ω—Ç–µ-–ö–∞—Ä–ª–æ
generate_MonteCarlo = function(n) { 
  points = list()
  for (i in 1:n){
    U <-runif(1)
    #—É–≥–æ–ª –º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è w –∏ –æ—Å—å—é z
    #–¥–ª—è —Å—Ñ–µ—Ä—ã —É–º–Ω–æ–∂–∞–µ—Ç—Å—è U –Ω–∞ 2
    theta <- acos(1-U) 
    phi <- runif(1,0,2*pi) #—É–≥–æ–ª –º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è w –∏ –æ—Å—å—é —Ö
    X <- R*sin(theta) * cos(phi)
    Y <- R*sin(theta) * sin(phi)
    Z <- R*cos(theta)
    points[[i]] = c(X,Y,Z)
    #print(points)
    #–∑–∞–ø–∏—à–µ–º –≤—Å–µ –ø–æ–ª—É—á–∏–≤—à–∏–µ—Å—è –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã n —Ç–æ—á–µ–∫ –≤ –æ–¥–∏–Ω –≤–µ–∫—Ç–æ—Ä
    #point = unlist(points)
    #print("point") 
    #print(point)
  }
  return (points)
}

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ –ø–µ—Ä–µ—Å–µ—á–µ–Ω–∏–µ —Å —à–∞—Ä–æ–º
calc_s = function(generated_points){
  for (i in 1:n){
    a = sum(generated_points[[i]]^2) 
    b = -2*(generated_points[[i]][1]*center[1]+generated_points[[i]][2]*center[2]+generated_points[[i]][3]*center[3])
    c = sum(center^2)-R^2
    #V - —Ç–∞–∫ –Ω–∞–∑—ã–≤–∞–µ–º–∞—è —Ñ—É–Ω–∫—Ü–∏—è –≤–∏–¥–∏–º–æ—Å—Ç–∏,
    #–µ—Å–ª–∏ –ø—Ä—è–º–∞—è  –Ω–∞–ø—Ä–∞–≤–ª—è—é—â–∏–º –≤–µ–∫—Ç–æ—Ä–æ–º w  –ø–µ—Ä–µ—Å–µ–∫–∞–µ—Ç —à–∞—Ä, —Ç–æ 1, –∏–Ω–∞—á–µ 0
    V = diskrim(a,b,c)
    #print("V")
    #print(V)
    if (V == 1){
      sum_V <- sum_V + 1
    }
  }
  #print(sum_V)
  return (2 * pi / ((gamma+1)*n) * sum_V)
}

#–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –º–µ—Ç–æ–¥–∞ —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏ 
generate_ImpSampling = function(n){
  points = list()
  for (i in 1:n){
    U <-runif(1)
    #—É–≥–æ–ª –º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è w –∏ –æ—Å—å—é z
    #–¥–ª—è —Å—Ñ–µ—Ä—ã —É–º–Ω–æ–∂–∞–µ—Ç—Å—è U –Ω–∞ 2
    theta = acos((1 - runif(1)^(1/(gamma+1))))  
    phi = runif(1, 0, pi/2) #—É–≥–æ–ª –º–µ–∂–¥—É –≤–µ–∫—Ç–æ—Ä–æ–º –Ω–∞–ø—Ä–∞–≤–ª–µ–Ω–∏—è w –∏ –æ—Å—å—é —Ö
    X <- R*sin(theta) * cos(phi)
    Y <- R*sin(theta) * sin(phi)
    Z <- R*cos(theta)
    points[[i]] = c(X,Y,Z)
  }
  return (points)
}

s1 = c(rep(0,N))
s2 = c(rep(0,N))

for(i in 1:N) {
  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è n –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ç–æ—á–µ–∫ –º–µ—Ç–æ–¥–æ–º –ú-–ö
  points_MonteCarlo = generate_MonteCarlo(n) 
  for (i in 1:length(points_MonteCarlo)){
    points3d(points_MonteCarlo[[i]],col="red")
  }
  # –†–∞—Å—á–µ—Ç –æ—Ü–µ–Ω–æ–∫ –ú-–ö
  sum_V <- 0
  s1 <- c(s1, calc_s(points_MonteCarlo))
  s1
  
  # –ì–µ–Ω–µ—Ä–∞—Ü–∏—è n –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç —Ç–æ—á–µ–∫ –º–µ—Ç–æ–¥–æ–º —Å—É—â–µ—Å—Ç–≤–µ–Ω–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏ 
  points_ImpSamplingb = generate_ImpSampling(n)
  for (i in 1:length(points_MonteCarlo)){
    points3d(points_ImpSamplingb[[i]],col="red")
  }
  sum_V <- 0
  s2 <- c(s2, calc_s(points_ImpSamplingb)) # –†–∞—Å—á–µ—Ç –æ—Ü–µ–Ω–æ–∫
  s2
}

cat(mean(s1), "\n")
cat(mean(s2), "\n")
cat(var(s1), "\n")
cat(var(s2), "\n")
